---
title: Garbage Collection in JVM
date: 2019-10-22 15:00:43
tags:
- java
- jvm
- android
- android runtime
categories:
- java
- android
---
接触过 Java 语言或者 Java 体系相关技术的各位同学应该都或多或少的见到过 `JVM` 这个概念，它的中文名字叫做 Java 虚拟机，本质上也是一个程序。 在使用 C，C++ 等语言进行开发的过程中，申请内存，回收内存等工作都需要我们自己手动进行；而当我们使用 Java 时，申请内存的主要形式是创建对象，需要使用 new 关键字，但我们似乎没做过任何与回收内存有关的事情，原因在于，Java 程序是运行在 JVM 上的，Java 体系提倡自动化的内存管理，当程序运行起来的时候，回收内存相关的几乎一切事情都由 JVM 帮我们处理好了。但是，把管理内存这么重要的事情交给一个我们不熟悉的程序去处理难免会觉得不放心，所以我们可能需要了解一下 JVM 处理内存事务的一些细节。本文假设读者对 Java 内存分区有一定了解，主要介绍 JVM 进行 GC 的流程，所涉及到的知识点以及我们需要注意或者可以加以利用的一些地方。
<!--more-->
## 概述
GC 全称叫做 Garbage Collection，翻译过来就叫做垃圾回收。Java 作为一种处处包含着面向对象思想的编程语言，我们要实现的几乎每一个业务逻辑都需要借助对象来实现，所以在程序运行的过程中会源源不断的产生各种对象。这些对象之中的一些可能需要一直被使用，而另一些在发挥了它的作用后就不再被需要了，这些我们不再会去使用但还占据着一块内存的对象，就是我们需要回收的“垃圾”。而 GC 就是指 JVM 帮助我们去回收这些对象，释放内存以供新对象使用的过程。
### GC 日志
VM options 添加参数 -XX:+PrintGCDetails
### 为什么要注意 GC
前面提到，Java 的 GC 工作是完全有 JVM 承担，自动化的进行，我们不需要专门为回收内存编写任何像 C 或 C++ 中的 free 一样的代码。虽然自动化的回收内存这种技术已经经过了半个世纪的发展，在大多数情况下已经非常成熟可靠了，但仍然会有一些时候，由于我们自己在编写代码时的不谨慎，导致 JVM 在 GC 时会出现一些我们不希望出现的情况，例如内存泄漏以及随之而来的内存溢出导致程序崩溃，这就需要我们对 JVM 的 GC 过程和原理加以了解，方便我们排查解决这些问题。
## GC 原理
首先先介绍一下 JVM GC 的基本原理，主要包括`标记`需要被回收的对象所使用的算法，`GC 算法`，Java 中四种类型的`引用`，以及常用的虚拟机`Hotspot`和贵组要经常接触的`Android Runtime`在进行 GC 时的一些细节。
### 标记算法
引用计数简单介绍，GC Roots 可达性分析具体解释，画图。
### GC 算法
三种 GC 算法画图解释。
### 引用
解释四种引用。
### Hotspot GC 细节
### Android Runtime
## GC 器
GC 器，翻译过来叫做垃圾回收器，是前面提到的 GC 原理中的算法的具体实现，JVM 中实现了很多种不同的 GC 器以适应不同情况，这里主要介绍一下 G1 垃圾回收器以及 CMP 垃圾回收器的细节。
### G1
### CMP
## 内存分配和回收策略
除了 GC 阶段之外，在创建对象，分配内存的阶段，JVM 也采用了一些特殊的策略，以配合 GC 器安全高效的完成 GC 工作，这里介绍一些多数虚拟机通用的内存分配策略。




## 分享安排
### 科创
基础概念，GC 算法。 GC 日志查看。
### 联创
简单看一下内存模型，GC 算法，重点关注 GC 器实现，GC 日志，内存分配策略。  重点关注 GC 器实现和 ART 的特性。

